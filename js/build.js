"use strict";function S(e){return document.querySelector(e)}function SA(e){return document.querySelectorAll(e)}function startLoader(){S(".main_block").clientWidth<600?S("#topLoader").classList.add("top_loader_go"):S("#leftLoader").classList.add("top_loader_go")}function stopLoader(){S(".main_block").clientWidth<600?S("#topLoader").classList.remove("top_loader_go"):S("#leftLoader").classList.remove("top_loader_go")}function ServerMsg(){this.block=S("#serverError"),this.msg=S(".server_error_text"),this.closeBtn=S(".server_error_close_btn");var e=this;this.setMsg=function(e){this.msg.textContent=e},this.show=function(){this.block.classList.add("server_error_show")},this.hide=function(){this.block.classList.remove("server_error_show")},this.clearMsg=function(){this.msg.textContent=""},this.showAndSetMsg=function(e){this.setMsg(e),this.show()},this.closeBtn.addEventListener("click",function(){e.hide()})}function Ajax(e,t,a){this.success=function(e){},this.dataError=function(e){},this.serverError=function(){},this.netError=function(){},this.commonFun=function(){},this.commonErrorFun=function(){},this.method="POST",this.endpoint=e,this.body=t;var n=this,r=new XMLHttpRequest;this.setupOpen=function(e,t){},this.reopen=function(){r.open(this.method,this.endpoint,!0)},r.open(this.method,this.endpoint,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.onload=function(){if(stopLoader(),n.commonFun(),200<=this.status&&this.status<400){null!=a&&console.log(this.response);try{var t=JSON.parse(this.response)}catch(e){console.log(e.name),console.log(e.message),console.log("-------------"),console.log("SERVER - "+this.response),console.log("-------------");t={error:1,errorMsg:"Сервер вернул некорректные данные. Попробуйте обновить страницу."}}1==t.error?(n.commonErrorFun(),n.dataError(t)):n.success(t)}else n.commonErrorFun(),n.serverError()},r.onerror=function(){n.commonErrorFun(),n.commonFun(),n.netError(),stopLoader()},this.start=function(){startLoader(),r.send(this.body)}}window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var tem=new Array;function contentRender(e,t){if(tem[t])var a=tem[t];else{console.log("шаблон не из кеша");a=S(t).innerHTML}var n="",r=a;for(var i in e){var s=a;if("object"==typeof e[i]){for(var o in e[i])s=s.replace("[%"+o+"%]",e[i][o]);s!=a&&(n+=s)}else r=r.replace("[%"+i+"%]",e[i])}return r!=a&&(n+=r),n}function getItemFromCollectionByClass(e,t){for(var a=0;a<t.length;a++)if(t[a].classList.contains(e))return t[a];return!1}function checkBtn(e,t,a){for(;e.id!=t;){if(e.classList.contains(a))return e;e=e.parentNode}return!1}function swapCssClass(e,t,a){e.classList.remove(t),e.classList.add(a)}function hasCssClass(e,t){return!!e.classList.contains(t)}function animateEnd(e,t,a,n){var r=setInterval(function(){getComputedStyle(e)[t]==a&&(clearInterval(r),n(e))},0)}function htmlStringToElement(e){return S("#serviceBlock").innerHTML=e,S("#serviceBlock").firstElementChild}function getObjectFromArrayByFieldValue(e,t,a,n){var i=!1;return function e(t,a,n,r){if(t.length>a&&1!=i)return Array.isArray(t[a])?e(t[a],0,n,r):t[a][n]==r?(i=!0,t[a]):e(t,a+1,n,r)}(e,t,a,n)}function getPostVars(e){var t="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId;for(var a in e)t+="&"+a+"="+e[a];return t}SA(".template").forEach(function(e){tem["#"+e.id]=e.innerHTML});var GB={gamesTeseraId:new Array,gameDetail:{},addBtnIcon:"add",editBtnIcon:"edit",saveBtnIcon:"check",doneBtnIcon:"done",closeBtnIcon:"close",favoriteBtnIcon:"favorite",haveItemBtnIcon:"check_circle",playBtnIcon:"play_arrow",stopBtnIcon:"stop",pauseBtnIcon:"pause",noWinnerText:"Нет (Игра)",pup:{},serverMsg:new ServerMsg,contentLoader:"",request:new Ajax,userGroups:void 0,userPlayers:void 0,userMatchTags:void 0,match:{}};function serverRequestBtn(e,t,a,n,r){if(hasCssClass(e,"data_transfering"))GB.serverMsg.showAndSetMsg("Запрос в обработке.");else{e.classList.add("data_transfering"),GB.serverMsg.hide();var i=new Ajax("http://bgstat.ru/back/"+t,a,r);i.commonFun=function(){e.classList.remove("data_transfering")},i.commonErrorFun=function(){GB.serverMsg.show()},i.success=function(e){n(e)},i.dataError=function(e){GB.serverMsg.showAndSetMsg(e.errorMsg)},i.netError=function(){GB.serverMsg.setMsg("Неизвестная ошибка.")},i.serverError=function(){GB.serverMsg.setMsg("Сервер доступен, но возвращает неизвествую ошибку.")},i.start()}}function getContent(e,t,a,n,r){GB.serverMsg.hide(),GB.contentLoader.go();var i=new Ajax("http://bgstat.ru/back/"+e,t);i.commonFun=function(){GB.contentLoader.stop()},i.success=function(e){S(n).insertAdjacentHTML("afterBegin",contentRender(e,a)),r&&r(e)},i.dataError=function(e){GB.serverMsg.showAndSetMsg(e.errorMsg)},i.netError=function(){GB.serverMsg.showAndSetMsg("Неизвестная ошибка.")},i.serverError=function(){GB.serverMsg.showAndSetMsg("Сервер доступен, но возвращает неизвествую ошибку.")},i.start()}function pinnedBlock(e,t,a,n,r){var i,s=r||"value",o=e.parentNode.querySelector("."+a).getAttribute("data-id");i=hasCssClass(e,"pinned_status_0")?1:0;var c="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&pinned="+i+"&itemId="+o;serverRequestBtn(e,n,c,function(){insertItemInListBySortPinned(t,a,e,i,s)})}function insertItemInListBySort(e,t,a,n,r,i){r=r||"value";var s=a.parentNode,o=s.querySelector("."+t)[r],c=SA(e+" .pinned_status_"+n);if(i?s.removeEventListener("transitionend",i,!0):(s.classList.add("swipe_left"),s.classList.add("insert_shadow")),0==c.length)1==n?s!=S(e).firstElementChild&&S(e).insertBefore(s,S(e).firstElementChild):S(e).appendChild(s);else{for(var l=0;l<c.length;l++){var d=c[l].parentNode.querySelector("."+t)[r];if(o.toUpperCase()<=d.toUpperCase()){S(e).insertBefore(s,c[l].parentNode);break}}if(l==c.length){var m=c[c.length-1].parentNode.nextElementSibling;s!=m&&S(e).insertBefore(s,m)}}1==n?swapCssClass(a,"pinned_status_0","pinned_status_1"):swapCssClass(a,"pinned_status_1","pinned_status_0"),setTimeout(function(){s.classList.remove("swipe_left")},50),setTimeout(function(){s.classList.remove("insert_shadow")},500)}function insertItemInListBySortPinned(t,a,n,r,i){var e=n.parentNode;e.classList.add("swipe_left"),e.classList.add("insert_shadow"),e.addEventListener("transitionend",function e(){insertItemInListBySort(t,a,n,r,i,e)},!0)}function toCheckBtn(e){0==e.getAttribute("data-selected")?(e.setAttribute("data-selected","1"),e.children[0].textContent="check"):(e.setAttribute("data-selected","0"),e.children[0].textContent="")}function getSelectedInList(e,t){var a=new Array;return e.querySelectorAll("div[data-selected='1']").forEach(function(e){a.push(e.getAttribute(t))}),a}function toggleWidgetHandler(e){this&&(e=this);var t=e.getAttribute("data-value");e.parentNode.setAttribute("data-value",t),e.parentNode.querySelector(".toggle_btn_active")&&e.parentNode.querySelector(".toggle_btn_active").classList.remove("toggle_btn_active"),e.classList.add("toggle_btn_active")}function delItemInList(e,t){var a=e.parentNode,n=e.parentNode.parentNode.id,r=a.querySelector(".name").getAttribute("data-id");serverRequestBtn(e,t,"email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&hide=1&itemId="+r,function(){a.classList.add("folded_height"),animateEnd(a,"maxHeight","0px",function(){S("#"+n).removeChild(a)})})}function getPinnedStatus(e){return hasCssClass(e,"pinned_status_0")?0:1}function Popup(e){this.body=S(e),this.content=S(e+" .content_in_block"),this.activeBtn=S(e+" .close_popup"),this.shadow=S(".popup_shadow");var t=this;this.hide=function(){t.shadow.classList.remove("popup_shadow_show"),t.body.classList.remove("popup_expand"),this.bodyHandler=function(){}},this.show=function(){t.body.classList.add("popup_expand"),t.shadow.classList.add("popup_shadow_show")},this.setContent=function(e){t.content.innerHTML=e},this.setActiveBtnIcon=function(e){t.activeBtn.firstElementChild.textContent=e},this.activeBtnHandler=function(){t.hide()},this.bodyHandler=function(){},this.body.addEventListener("click",function(e){t.bodyHandler.call(this,e)}),this.activeBtn.addEventListener("click",function(){t.activeBtnHandler()})}function delTagLink(t,a,e,n){if(n||(n=function(e){S(a+" .content_in_block").removeChild(t.parentNode)}),e){var r="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&tagId="+t.getAttribute("data-id")+"&gameId="+GB.gameDetail.id;serverRequestBtn(t,e,r,n)}else n()}function RatingWidget(e,t){var a=this;function n(){var e=a.body.querySelector(".selected");e&&e.classList.remove("selected"),this.classList.add("selected"),a.additionalSetupHandler()}this.body=S("#ratingWidgetTemplate").cloneNode(!0),this.body.removeAttribute("id"),this.body.removeAttribute("class"),this.additionalSetupHandler=function(){},this.body.querySelector(".rating_widget_title").textContent=t,e&&this.body.querySelector(".btn[data-value='"+e+"']").classList.add("selected"),this.getValue=function(){var e=this.body.querySelector(".selected");return e?e.textContent:null},this.getHtml=function(){return this.body.innerHTML},this.getElement=function(){return this.body},this.body.querySelectorAll(".btn").forEach(function(e){e.addEventListener("click",n)})}function liveSearchDataToTemplete(n,r){return function(e){var t=new Array;e.forEach(function(e){e.photoUrl&&(0<=GB.gamesTeseraId.indexOf(e.teseraId)?e.iconName=GB.haveItemBtnIcon:e.iconName=GB.addBtnIcon,t.push(e))});var a=contentRender(t,n);S(r).innerHTML=a,stopLoader()}}function getNotSelectedItems(e,t,a){if(!a)a="data-id";var n=new Array;return SA(t).forEach(function(e){n.push(e.getAttribute(a))}),e.filter(function(e){return n.indexOf(e.id)<0})}function getMain(){}function getAddMatchForm(){GB.contentLoader.stop()}GB.contentLoader={go:function(){S("#contentLoader").style.display="block"},stop:function(){S("#contentLoader").style.display="none"}},GB.pup=new Popup("#popup"),GB.pup.setupMultiSelectHandler=function(n,r,i){return function(e){var t=checkBtn(e.target,"popup","check_btn");if(t){toCheckBtn(t);var a=getSelectedInList(GB.pup.body,"data-id");0<a.length?(GB.pup.setActiveBtnIcon(GB.addBtnIcon),GB.pup.activeBtnHandler=function(e){r?serverRequestBtn(t,r,i=i+"&itemsList="+a,n):n(a),GB.pup.setActiveBtnIcon(GB.closeBtnIcon),GB.pup.activeBtnHandler=GB.pup.hide,GB.pup.setContent(""),GB.pup.hide()}):(GB.pup.setActiveBtnIcon(GB.closeBtnIcon),GB.pup.activeBtnHandler=GB.pup.hide)}}},GB.match.setDefaultDateMatchForm=function(){var e=new Date;S("#matchDateDay").value=e.getDate(),S("#matchDateMonth").value=e.getMonth()+1,S("#matchDateYear").value=e.getFullYear()},GB.match.setDefaultDateMatchForm(),GB.match.closeAddMatchForm=function(){window.history.back()},S("#addMatchFormCloseBtn").addEventListener("click",function(){GB.match.closeAddMatchForm()}),GB.match.gameSetup=function(e,t,a){S("#matchGameTitle").textContent=t,S("#matchGameTitle").setAttribute("data-tesera-id",e),S("#matchGameTitle").setAttribute("data-name",t),S("#matchGameTitle").setAttribute("data-img",a)};var matchTeseraApiRequest=new Ajax;matchTeseraApiRequest.method="GET",matchTeseraApiRequest.success=liveSearchDataToTemplete("#gameInSearchListTemplate","#matchGameSearchList"),S("#seacrhMatchGameField").addEventListener("input",function(){1<=this.value.length?(startLoader(),S("#match-gameSearchBlock").classList.add("shadow_drop"),S("#matchGameSearchList").classList.remove("hide"),S("#closeSearchMatchGameBtn").classList.remove("btn_collapsed"),S("#seacrhMatchGameField").classList.add("search_active"),matchTeseraApiRequest.endpoint="https://api.tesera.ru/search?query="+this.value,matchTeseraApiRequest.reopen(),matchTeseraApiRequest.start()):(S("#match-gameSearchBlock").classList.remove("shadow_drop"),S("#matchGameSearchList").classList.add("hide"),S("#closeSearchMatchGameBtn").classList.add("btn_collapsed"),S("#seacrhMatchGameField").classList.remove("search_active"))}),GB.match.matchSearchClear=function(){S("#match-gameSearchBlock").classList.remove("shadow_drop"),S("#matchGameSearchList").innerHTML="",S("#seacrhMatchGameField").value="",S("#matchGameSearchList").classList.add("hide"),S("#closeSearchMatchGameBtn").classList.add("btn_collapsed"),S("#seacrhMatchGameField").classList.remove("search_active")},S("#closeSearchMatchGameBtn").addEventListener("click",function(){GB.match.matchSearchClear()}),S("#matchGameSearchList").addEventListener("click",function(e){var t=checkBtn(e.target,"matchGameSearchList","btn");if(t){var a=t.parentNode,n=a.querySelector(".text_in_search").textContent,r=a.querySelector(".img_in_search").src,i=a.querySelector(".text_in_search").getAttribute("data-tesera-id");GB.match.gameSetup(i,n,r),GB.match.matchSearchClear()}}),GB.match.clearGroupTitle=function(){var e=S("#matchGroupId");""!=e.textContent&&(e.textContent="",e.setAttribute("data-group-id",0),e.classList.remove("sub_block_opened"),e.classList.remove("match_group_title_correct"))},S("#matchGroupSelectBtn").addEventListener("click",function(e){function t(e){GB.pup.setContent(contentRender(e,"#selectOneTemplate")),GB.pup.show(),GB.pup.bodyHandler=function(e){var t=checkBtn(e.target,"popup","add_btn");if(t){var a=t.getAttribute("data-id"),n=t.parentNode.querySelector(".name").value,r=S("#matchGroupId");r.textContent=n,r.setAttribute("data-group-id",a),r.classList.add("sub_block_opened"),r.classList.add("match_group_title_correct"),S("#playersInMatch").innerHTML="",getObjectFromArrayByFieldValue(GB.userGroups,0,"id",a).playersList.forEach(function(e){var t=contentRender({id:e,name:getObjectFromArrayByFieldValue(GB.userPlayers,0,"id",e).name},"#playerInListFromGroupTemplate");S("#playersInMatch").insertAdjacentHTML("beforeEnd",t)}),GB.pup.hide()}}}GB.userGroups?t(GB.userGroups):serverRequestBtn(this,"groupGet.php",a="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId,function(e){GB.userGroups=e,t(GB.userGroups)});if(!GB.userPlayers){var a="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId;serverRequestBtn(GB.pup.activeBtn,"playerGet.php",a,function(e){GB.userPlayers=e})}}),S("#matchPlayersSelectBtn").addEventListener("click",function(){function t(e){var t=getNotSelectedItems(e,"#playersInMatch [data-player-id]","data-player-id");GB.pup.setContent(contentRender(t,"#multiSelectTemplate")),GB.pup.show(),GB.pup.bodyHandler=GB.pup.setupMultiSelectHandler(function(e){e.forEach(function(e){var t=contentRender({id:e,name:getObjectFromArrayByFieldValue(GB.userPlayers,0,"id",e).name},"#playerInListFromGroupTemplate");S("#playersInMatch").insertAdjacentHTML("beforeEnd",t)}),GB.match.clearGroupTitle()})}if(GB.userPlayers)t(GB.userPlayers);else{var e="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId;serverRequestBtn(GB.pup.activeBtn,"playerGet.php",e,function(e){GB.userPlayers=e,t(GB.userPlayers)})}}),S("#playersInMatch").addEventListener("click",function(e){var t=checkBtn(e.target,"playersInMatch","btn");t&&(t.parentNode.parentNode.classList.add("invis"),animateEnd(t.parentNode.parentNode,"opacity","0",function(){S("#playersInMatch").removeChild(t.parentNode.parentNode),GB.match.clearGroupTitle()}))}),S("#matchWinnerToggle").addEventListener("click",function(e){var t=checkBtn(e.target,"matchWinnerToggle","toggle_btn");t&&("no"==t.getAttribute("data-value")?S("#matchWinnerSelectBtn").classList.add("btn_height_rollout"):(S("#matchWinnerSelectBtn").classList.remove("btn_height_rollout"),S("#matchWinner").classList.remove("sub_block_opened")),toggleWidgetHandler(t))}),S("#matchWinnerSelectBtn").addEventListener("click",function(){var t=new Array;SA("#playersInMatch [data-player-id]").forEach(function(e){t.push({name:e.textContent,id:e.getAttribute("data-player-id")})}),t.push({name:GB.noWinnerText,id:"noWinner"}),GB.pup.show(),GB.pup.setContent(contentRender(t,"#selectOneTemplate")),GB.pup.bodyHandler=function(e){var t=checkBtn(e.target,"popup","add_btn");t&&(GB.pup.hide(),S("#matchWinner").classList.add("sub_block_opened"),S("#matchWinner").textContent=t.parentNode.firstElementChild.value,S("#matchWinner").setAttribute("data-winner-id",t.getAttribute("data-id")))}}),S("#matchPlaceSelectBtn").addEventListener("click",function(){serverRequestBtn(this,"locationGet.php","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId,function(e){GB.pup.show(),GB.pup.setContent(contentRender(e,"#selectOneTemplate")),GB.pup.bodyHandler=function(e){var t=checkBtn(e.target,"popup","add_btn");t&&(GB.pup.hide(),S("#matchPlace").classList.add("sub_block_opened"),S("#matchPlace").textContent=t.parentNode.firstElementChild.value,S("#matchPlace").setAttribute("data-place-id",t.getAttribute("data-id")))}})}),S("#matchComment").addEventListener("focus",function(){S("#matchComment").classList.add("big_text")}),S("#matchAdvice").addEventListener("focus",function(){S("#matchAdvice").classList.add("big_text")}),GB.match.mood=new RatingWidget(3,"Настроение"),S("#matchMood").appendChild(GB.match.mood.getElement()),GB.match.interest=new RatingWidget(3,"Интерес"),S("#matchInterest").appendChild(GB.match.interest.getElement()),GB.match.complexity=new RatingWidget(3,"Сложность"),S("#matchComplexity").appendChild(GB.match.complexity.getElement()),GB.match.score=new RatingWidget(3,"Оценка"),S("#matchScore").appendChild(GB.match.score.getElement()),S("#addNewTagForMatch").addEventListener("click",function(){function t(e){var t=getNotSelectedItems(e,"#matchTags .tag [data-id]");GB.pup.setContent(contentRender(t,"#multiSelectTemplate")),GB.pup.show(),GB.pup.bodyHandler=GB.pup.setupMultiSelectHandler(function(e){e.forEach(function(e){var t=contentRender({id:e,name:getObjectFromArrayByFieldValue(GB.userMatchTags,0,"id",e).name},"#gameTagTemplate");S("#matchTags .content_in_block").insertAdjacentHTML("beforeEnd",t)})})}GB.userMatchTags?t(GB.userMatchTags):serverRequestBtn(this,"tagGet.php?type=match","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId,function(e){GB.userMatchTags=e,t(GB.userMatchTags)})}),S("#matchTags .content_in_block").addEventListener("click",function(e){var t=checkBtn(e.target,"matchTags","close_tag");t&&delTagLink(t,"#matchTags")});var matchTimer={startTime:0,playedTime:0,currentPauseTime:0,allPauseTime:0,startPauseTime:0,status:"",timeToClock:function(e){return e<10?"0"+e:e},updateTimer:function(){var e=Math.floor(Date.now()/1e3);matchTimer.playedTime=e-matchTimer.startTime-matchTimer.allPauseTime,S("#matchTimeHours").value=matchTimer.timeToClock(Math.floor(matchTimer.playedTime/3600)),S("#matchTimeMinutes").value=matchTimer.timeToClock(Math.floor(matchTimer.playedTime%3600/60)),S("#matchTimeSeconds").value=matchTimer.timeToClock(Math.floor(matchTimer.playedTime%3600%60))},start:function(e){S("#matchTimerPlay").firstElementChild.textContent=GB.pauseBtnIcon,e?(clearInterval(matchTimer.pauseTimerId),matchTimer.allPauseTime+=matchTimer.currentPauseTime,matchTimer.currentPauseTime=0,matchTimer.startPauseTime=0):matchTimer.startTime=Math.floor(Date.now()/1e3),matchTimer.timer=setInterval(matchTimer.updateTimer,100)},pauseTimer:function(){var e=Math.floor(Date.now()/1e3);matchTimer.currentPauseTime=e-matchTimer.startPauseTime},pause:function(){clearInterval(matchTimer.timer),S("#matchTimerPlay").firstElementChild.textContent=GB.playBtnIcon,matchTimer.startPauseTime=Math.floor(Date.now()/1e3),matchTimer.pauseTimerId=setInterval(matchTimer.pauseTimer,100)},stop:function(){clearInterval(matchTimer.timer),clearInterval(matchTimer.pauseTimerId),S("#matchTimerPlay").setAttribute("data-status","stop"),S("#matchTimerPlay").firstElementChild.textContent=GB.playBtnIcon,matchTimer.startTime=0,matchTimer.playedTime=0,matchTimer.allPauseTime=0,matchTimer.startPauseTime=0,matchTimer.currentPauseTime=0,S("#matchTimeHours").value="",S("#matchTimeMinutes").value="",S("#matchTimeSeconds").value=""},getTime:function(){var e=0;return e+=3600*Number(S("#matchTimeHours").value),e+=60*Number(S("#matchTimeMinutes").value),e+=Number(S("#matchTimeSeconds").value)},getDate:function(){var e=S("#matchDateYear").value;return e+="-"+S("#matchDateMonth").value,e+="-"+S("#matchDateDay").value}};function getMatches(){""!=S("#matchContent").innerHTML&&(S("#matchContent").innerHTML=""),GB.contentLoader.stop();var o=new Date,e=document.documentElement,n=!1,t=0,r=!1;function a(e,t){var a=getPostVars({from:e,quantity:t});serverRequestBtn(S("#matchesFilterBtn"),"matchGet.php",a,function(e){e.forEach(function(e){var t,a;e.winStatus=t="no"==(t=e.winStatus)?"Проигрыш":"yes"==t?"Победа":"Ничья",e.matchTime=(a=e.matchTime,matchTimer.timeToClock(Math.floor(a/60))+":"+matchTimer.timeToClock(a%60));var n,r,i=new Date(e.date);if(o.getTime()!=i.getTime()){var s={dayName:(r=i,["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"][r.getDay()]),dayNumber:i.getDate(),monthName:(n=i,["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"][n.getMonth()]),year:i.getFullYear()};S("#matchContent").insertAdjacentHTML("beforeEnd",contentRender(s,"#matchBlockDateTemplate")),S("#matchContent").insertAdjacentHTML("beforeEnd",contentRender(e,"#matchBlockTemplate")),o=i}else S("#matchContent").insertAdjacentHTML("beforeEnd",contentRender(e,"#matchBlockTemplate"))}),n=!1,e.length<t&&(r=!0)})}a(t,20),window.addEventListener("scroll",function(){hasCssClass(S("#matchesBlock"),"active_content_block")&&e.scrollHeight-e.scrollTop<=e.clientHeight+200&&!n&&!r&&(n=!0,t+=20,console.log(t),a(t,20))})}function getGames(){""!=S("#gameContent").innerHTML&&(S("#gameContent").innerHTML=""),getContent("gameGet.php",getPostVars(),"#gameBlockTemplate","#gameContent",function(e){for(var t in e)GB.gamesTeseraId.push(Number(e[t].teseraId))})}S("#matchTimerPlay").addEventListener("click",function(){var e=S("#matchTimerPlay").getAttribute("data-status");"stop"==e?(matchTimer.start(),S("#matchTimerPlay").setAttribute("data-status","play")):"play"==e?(matchTimer.pause(),S("#matchTimerPlay").setAttribute("data-status","pause")):(matchTimer.start("pause"),S("#matchTimerPlay").setAttribute("data-status","play"))}),S("#matchTimerStop").addEventListener("click",matchTimer.stop),S("#addMatchBtn").addEventListener("click",function(){function n(){GB.match.setDefaultDateMatchForm(),matchTimer.stop(),GB.match.clearGroupTitle(),S("#matchGameTitle").textContent="",S("#matchGameTitle").setAttribute("data-tesera-id",""),S("#playersInMatch").innerHTML="",S("#playersInMatchBlock .match_players_list_score input").value="",S("#matchWinnerToggle").setAttribute("data-value",""),S("#matchWinnerToggle .toggle_btn_active").classList.remove("toggle_btn_active"),S("#matchWinner").classList.remove("sub_block_opened"),S("#matchPlace").classList.remove("sub_block_opened"),S("#matchPlace").setAttribute("data-place-id",""),S("#matchComment").value="",S("#matchComment").classList.remove("big_text"),S("#matchAdvice").value="",S("#matchAdvice").classList.remove("big_text"),S("#matchTags .content_in_block").innerHTML=""}var t=new Object;t.teseraGameName=S("#matchGameTitle").getAttribute("data-name"),t.teseraGameImg=S("#matchGameTitle").getAttribute("data-img"),t.teseraGameId=S("#matchGameTitle").getAttribute("data-tesera-id"),t.date=matchTimer.getDate(),t.matchTime=Math.floor(matchTimer.getTime()/60),t.groupId=S("#matchGroupId").getAttribute("data-group-id"),t.playersList=new Array,SA("#playersInMatchBlock [data-player-id]").forEach(function(e){t.playersList.push(e.getAttribute("data-player-id"))}),t.playersScore=new Array,SA("#playersInMatchBlock .match_players_list_score input").forEach(function(e){""!=e.value?t.playersScore.push(e.value):t.playersScore.push(null)}),t.winStatus=S("#matchWinnerToggle").getAttribute("data-value"),t.winnerId=S("#matchWinner").getAttribute("data-winner-id"),t.locationId=S("#matchPlace").getAttribute("data-place-id"),t.mood=GB.match.mood.getValue(),t.interest=GB.match.interest.getValue(),t.complexity=GB.match.complexity.getValue(),t.score=GB.match.score.getValue(),t.comment=S("#matchComment").value,t.advice=S("#matchAdvice").value,t.tagList=new Array,SA("#matchTags .tag [data-id]").forEach(function(e){t.tagList.push(e.getAttribute("data-id"))}),serverRequestBtn(this,"matchAdd.php",getPostVars(t),function(e){GB.pup.setContent(S("#afterMatchAddFromTemplate").innerHTML),GB.pup.bodyHandler=function(e){var t=checkBtn(e.target,"popup","btn");if(t){var a=t.getAttribute("data-value");"goAway"==a?(n(),GB.pup.hide(),GB.match.closeAddMatchForm()):("stayAndClear"==a&&n(),GB.pup.hide())}},GB.pup.show()})}),S("#openAddMatchFormBtn").addEventListener("click",function(){location.hash="addMatch"}),S("#matchesFilterBtn").addEventListener("click",function(){var e={title:"В разработке.",text:"Работа над фильтрами ведется."};e.text+="В будущем планируется добавление широкого спектра критериев фильтрации партий.",GB.pup.setContent(contentRender(e,"#pupTextTemplate")),GB.pup.show()}),S("#matchContent").addEventListener("click",function(e){var a;if(a=checkBtn(e.target,"matchContent","block_with_img")){var n=a.parentNode.querySelector(".match_add_info");if("0"==n.getAttribute("data-load")){var t=getPostVars({matchId:a.querySelector("div[data-id]").getAttribute("data-id")});serverRequestBtn(a,"matchGetDetail.php",t,function(e){e.playersList.forEach(function(e){null===e.score&&(e.score="-")}),e.playersList=contentRender(e.playersList,"#matchAddInfoPlayerListTemplate"),e.tags=contentRender(e.tags,"#inlineBorderTemplate"),e.ratings=contentRender(e.ratings,"#inlineBorderKeyValueTemplate");var t=contentRender(e,"#matchAddInfoTemplate");n.innerHTML=t,n.setAttribute("data-load","1"),n.querySelector(".mai_playersList").innerHTML=e.playersList,n.classList.add("sub_block_opened")})}else n.classList.toggle("sub_block_opened")}if((a=checkBtn(e.target,"matchContent","collapse_btn"))&&a.parentNode.parentNode.classList.remove("sub_block_opened"),a=checkBtn(e.target,"matchContent","edit_btn")){var r={title:"В разработке.",text:"Редактирование партии на данный момент недоступно.<br>"};r.text+="Вы можете удалить и добавить партию заново с измененными значениями.",GB.pup.setContent(contentRender(r,"#pupTextTemplate")),GB.pup.show()}if(a=checkBtn(e.target,"matchContent","delete_btn")){t=getPostVars({matchId:a.getAttribute("data-match-id")});serverRequestBtn(a,"matchDelete.php",t,function(e){var t=a.parentNode.parentNode.parentNode;t.previousElementSibling.classList.contains("match_date_title")&&S("#matchContent").removeChild(t.previousElementSibling),S("#matchContent").removeChild(t)})}});var teseraApiRequst=new Ajax;function searchClear(){S("#newGameSearchList").innerHTML="",S("#seacrhGameField").value="",S("#newGameSearchList").classList.add("hide"),S("#closeSearchGameBtn").classList.add("btn_collapsed"),S("#seacrhGameField").classList.remove("search_active"),S("#gameContent").classList.remove("hide")}function getPlayers(){GB.userGroups=void 0,""!=S("#playerContent").innerHTML&&(S("#playerContent").innerHTML=""),getContent("playerGet.php","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId,"#playerBlockTemplate","#playerContent")}function playerBtnHandler(e){var t;(t=checkBtn(e.target,"playerContent","delete_btn"))&&delItemInList(t,"playerHideShow.php"),(t=checkBtn(e.target,"playerContent","pinned_btn"))&&pinnedBlock(t,"#playerContent","name","playerPinned.php"),(t=checkBtn(e.target,"playerContent","edit_btn"))&&editPlayer(t)}function editPlayer(e){var t=e.parentNode.querySelector(".name"),a=t.parentNode.querySelector(".delete_btn"),n=t.parentNode.querySelector(".pinned_btn");if(t.hasAttribute("disabled"))t.disabled=!1,t.classList.add("input_text_editable"),e.classList.add("margin_right_0"),a.classList.add("btn_collapsed"),n.classList.add("btn_collapsed"),e.children[0].textContent=GB.saveBtnIcon;else{var r="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&name="+t.value+"&playerId="+t.getAttribute("data-id");serverRequestBtn(e,"playerEdit.php",r,function(){t.disabled=!0,t.classList.remove("input_text_editable"),e.classList.remove("margin_right_0"),a.classList.remove("btn_collapsed"),n.classList.remove("btn_collapsed"),e.children[0].textContent=GB.editBtnIcon})}}function getGroups(){GB.userGroups=void 0,""!=S("#groupContent").innerHTML&&(S("#groupContent").innerHTML=""),getContent("groupGet.php",e="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId,"#groupBlockTemplate","#groupContent");var e="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId;serverRequestBtn(S("#addNewGroupBtn"),"playerGet.php",e,function(e){S("#playersListData").insertAdjacentHTML("afterBegin",contentRender(e,"#playersListTemplate"))})}function groupBtnHandler(e){var t;(t=checkBtn(e.target,"groupContent","delete_btn"))&&delItemInList(t,"groupHideShow.php"),(t=checkBtn(e.target,"groupContent","pinned_btn"))&&pinnedBlock(t,"#groupContent","name","groupPinned.php"),(t=checkBtn(e.target,"groupContent","edit_btn"))&&editGroup(t),(t=checkBtn(e.target,"groupContent","check_btn"))&&toCheckBtn(t)}function editGroup(e){var t=e.parentNode.querySelector(".name"),a=t.parentNode,n=a.querySelector(".delete_btn"),r=a.querySelector(".pinned_btn"),i=e.parentNode.querySelector(".sub_block"),s=i.querySelector(".limited_list"),o=t.getAttribute("data-players-list").split(",");if(t.hasAttribute("disabled")){if(t.disabled=!1,t.classList.add("input_text_editable"),e.classList.add("margin_right_0"),n.classList.add("btn_collapsed"),r.classList.add("btn_collapsed"),e.children[0].textContent="done",i.classList.add("sub_block_opened"),""==s.innerHTML)for(var c=S("#playersListData").children,l=0;l<c.length;l++){var d=c[l].cloneNode(!0),m=d.querySelector(".check_btn"),u=m.getAttribute("data-id");0<=o.indexOf(u)&&(m.firstChild.textContent="check",m.setAttribute("data-selected","1")),s.appendChild(d)}}else{o=getSelectedInList(s,"data-id");var p="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&name="+t.value+"&groupId="+t.getAttribute("data-id")+"&playersList="+o.toString();serverRequestBtn(e,"groupEdit.php",p,function(){t.disabled=!0,t.classList.remove("input_text_editable"),e.classList.remove("margin_right_0"),n.classList.remove("btn_collapsed"),r.classList.remove("btn_collapsed"),e.children[0].textContent="edit",i.classList.remove("sub_block_opened")})}}function getLocations(){""!=S("#locationContent").innerHTML&&(S("#locationContent").innerHTML=""),getContent("locationGet.php","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId,"#locationBlockTemplate","#locationContent")}function locationBtnHandler(e){var t;(t=checkBtn(e.target,"locationContent","delete_btn"))&&delItemInList(t,"locationHideShow.php"),(t=checkBtn(e.target,"locationContent","pinned_btn"))&&pinnedBlock(t,"#locationContent","name","locationPinned.php"),(t=checkBtn(e.target,"locationContent","edit_btn"))&&editLocation(t)}function editLocation(e){var t=e.parentNode.querySelector(".name"),a=t.parentNode.querySelector(".delete_btn"),n=t.parentNode.querySelector(".pinned_btn");if(t.hasAttribute("disabled"))t.disabled=!1,t.classList.add("input_text_editable"),e.classList.add("margin_right_0"),a.classList.add("btn_collapsed"),n.classList.add("btn_collapsed"),e.children[0].textContent="done";else{var r="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&name="+t.value+"&locationId="+t.getAttribute("data-id");serverRequestBtn(e,"locationEdit.php",r,function(){t.disabled=!0,t.classList.remove("input_text_editable"),e.classList.remove("margin_right_0"),a.classList.remove("btn_collapsed"),n.classList.remove("btn_collapsed"),e.children[0].textContent="edit"})}}function getTags(){var e="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId;""!=S("#tagContentMatch").innerHTML&&(S("#tagContentMatch").innerHTML=""),""!=S("#tagContentGame").innerHTML&&(S("#tagContentGame").innerHTML=""),getContent("tagGet.php?type=match",e,"#tagBlockTemplate","#tagContentMatch"),getContent("tagGet.php?type=game",e,"#tagBlockTemplate","#tagContentGame")}function tagBtnHandler(e){var t;((t=checkBtn(e.target,"tagContent","delete_btn"))&&delItemInList(t,"tagHideShow.php"),t=checkBtn(e.target,"tagContent","pinned_btn"))&&pinnedBlock(t,"#"+t.parentNode.parentNode.id,"name","tagPinned.php");(t=checkBtn(e.target,"tagContent","edit_btn"))&&editTag(t),(t=checkBtn(e.target,"tagContent","toggle_btn"))&&toggleWidgetHandler.call(t)}function delTag(e){var t=e.parentNode,a=e.parentNode.parentNode.id,n=t.querySelector(".name").getAttribute("data-id");serverRequestBtn(e,"tagHideShow.php","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&hide=1&tagId="+n,function(){t.classList.add("folded_height"),animateEnd(t,"maxHeight","0px",function(){S("#"+a).removeChild(t)})})}function editTag(e){var t=e.parentNode.querySelector(".name"),a=t.parentNode,n=a.querySelector(".delete_btn"),r=a.querySelector(".pinned_btn"),i=a.querySelector(".toggle_widget"),s=i.getAttribute("data-value");if(t.hasAttribute("disabled"))e.setAttribute("data-prev-value",s),i.classList.add("sub_block_opened"),t.disabled=!1,t.classList.add("input_text_editable"),e.classList.add("margin_right_0"),n.classList.add("btn_collapsed"),r.classList.add("btn_collapsed"),e.children[0].textContent="done",i.querySelector("div[data-value="+s+"]").classList.add("toggle_btn_active");else{var o=i.getAttribute("data-value"),c=t.getAttribute("data-id"),l="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&name="+t.value+"&tagId="+c+"&type="+o;serverRequestBtn(e,"tagEdit.php",l,function(){i.classList.remove("sub_block_opened"),t.disabled=!0,t.classList.remove("input_text_editable"),e.classList.remove("margin_right_0"),n.classList.remove("btn_collapsed"),r.classList.remove("btn_collapsed"),e.children[0].textContent="edit",e.getAttribute("data-prev-value")!=o&&insertItemInListBySort("#tagContent"+(o=o.charAt(0).toUpperCase()+o.substr(1)),"name",r,getPinnedStatus(r))})}}function getReports(){""!=S("#reportsContent").innerHTML&&(S("#reportsContent").innerHTML=""),getContent("reportsMainUserData.php",getPostVars(),"#reportsMainStat","#reportsContent")}function viewManager(){if(location.hash)var e=location.hash;else e="#main";switch(S(".title_text").textContent=S(e).textContent,S(".active_menu_item")&&(S("#"+S(".active_menu_item").id+"Block").classList.remove("active_content_block"),S(".active_menu_item").classList.remove("active_menu_item")),S(e).classList.add("active_menu_item"),S(e+"Block").classList.add("active_content_block"),e){case"#main":getMain();break;case"#matches":getMatches();break;case"#addMatch":getAddMatchForm();break;case"#games":getGames();break;case"#players":getPlayers();break;case"#groups":getGroups();break;case"#locations":getLocations();break;case"#tags":getTags();break;case"#reports":getReports();break;default:console.log("default load")}}function logRegSuccess(e){localStorage.bgsId=e.userId,localStorage.email=e.email,localStorage.pas=e.pas,S(".logRegForm").classList.remove("show"),S(".main_block").classList.add("show"),viewManager(),window.addEventListener("hashchange",viewManager)}function hideMenu(){S(".menu").classList.remove("menu_show"),S(".menu_button").classList.remove("active_menu_button"),S(".menu_shadow").classList.remove("menu_shadow_show")}function menuItemHandler(){location.hash=this.id,hideMenu()}teseraApiRequst.method="GET",teseraApiRequst.success=liveSearchDataToTemplete("#gameInSearchListTemplate","#newGameSearchList"),S("#seacrhGameField").addEventListener("input",function(){1<=this.value.length?(startLoader(),S("#newGameSearchList").classList.remove("hide"),S("#closeSearchGameBtn").classList.remove("btn_collapsed"),S("#seacrhGameField").classList.add("search_active"),S("#gameContent").classList.add("hide"),teseraApiRequst.endpoint="https://api.tesera.ru/search?query="+this.value,teseraApiRequst.reopen(),teseraApiRequst.start()):(S("#newGameSearchList").classList.add("hide"),S("#closeSearchGameBtn").classList.add("btn_collapsed"),S("#seacrhGameField").classList.remove("search_active"),S("#gameContent").classList.remove("hide"))}),S("#closeSearchGameBtn").addEventListener("click",function(){searchClear()}),S("#newGameSearchList").addEventListener("click",function(e){var t=checkBtn(e.target,"newGameSearchList","btn");if(t){var a=t.parentNode,n=a.querySelector(".text_in_search").textContent,r=a.querySelector(".text_in_search").getAttribute("data-tesera-id"),i=a.querySelector("img").src;if("add"==t.firstElementChild.textContent){var s="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&gameName="+n+"&teseraId="+r+"&gameImg="+i+"&date="+Date.now();serverRequestBtn(t,"gameAdd.php",s,function(e){t.firstElementChild.textContent=GB.haveItemBtnIcon,GB.gamesTeseraId.push(Number(e.teseraId)),S("#gameContent").insertAdjacentHTML("afterBegin",contentRender(e,"#gameBlockTemplate"))})}}}),S("#gameContent").addEventListener("click",function(e){var a;if(a=checkBtn(e.target,"gameContent","pinned_btn"))return pinnedBlock(a,"#gameContent","small_title","gamePinned.php","textContent"),!0;if(a=checkBtn(e.target,"gameContent","block_with_img")){GB.gameDetail.id=a.querySelector("div[data-id]").getAttribute("data-id"),GB.gameDetail.teseraId=a.querySelector("div[data-id]").getAttribute("data-tesera-id"),GB.gameDetail.name=a.querySelector("div[data-id]").textContent,GB.gameDetail.img=a.querySelector(".img_in_block").src;var t="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&gameId="+GB.gameDetail.id;return serverRequestBtn(a,"gameDetail.php",t,function(e){S("#newGameSearchBlock").classList.add("hide"),S("#gameContent").classList.add("hide"),S("#gameDetailName").textContent=e.name,S("#gameDetailPrice").value=e.price,S("#gameDetailRrc").value=e.rrc_price,S("#gameDetailComment").value=e.personal_comment,S("#gameDetailOpinion").value=e.public_opinion,0!=e.advices.length?(S("#gameDetail .advices").classList.remove("hide"),S("#gameDetail .advices .content_in_block").innerHTML=contentRender(e.advices,"#gameAdviceTemplate")):S("#gameDetail .advices").classList.add("hide"),S("#gameDetail .tags .content_in_block").innerHTML=contentRender(e.tags,"#gameTagTemplate"),S("#gameDetail").classList.remove("hide");var t=new RatingWidget(e.rating,"Оценка");S("#gameDetail .rating_widget").appendChild(t.getElement()),t.additionalSetupHandler=function(){var e="email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&gameId="+GB.gameDetail.id+"&rating="+this.getValue();serverRequestBtn(a,"gameRating.php",e,function(e){})}}),!0}}),GB.gameDetail.close=function(){S("#newGameSearchBlock").classList.remove("hide"),S("#gameContent").classList.remove("hide"),S("#gameDetail").classList.add("hide"),S("#gameDetail .rating_widget").innerHTML=""},S("#gameDetailAddMatchBtn").addEventListener("click",function(){GB.match.gameSetup(GB.gameDetail.teseraId,GB.gameDetail.name,GB.gameDetail.img),location.hash="addMatch",setTimeout(GB.gameDetail.close,500)}),S("#gameDetailCloseBtn").addEventListener("click",GB.gameDetail.close),S("#gameDetailTags .content_in_block").addEventListener("click",function(e){var t=checkBtn(e.target,"gameDetailTags","close_tag");t&&delTagLink(t,"#gameDetailTags","gameTagDel.php")}),S("#addNewTagForGame").addEventListener("click",function(){serverRequestBtn(this,"tagGet.php?type=game","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&gameId="+GB.gameDetail.id,function(e){GB.pup.setContent(contentRender(e,"#multiSelectTemplate")),GB.pup.show(),GB.pup.bodyHandler=GB.pup.setupMultiSelectHandler(function(e){S("#gameDetail .tags .content_in_block").innerHTML=contentRender(e.tags,"#gameTagTemplate")},"gameTagAdd.php","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&gameId="+GB.gameDetail.id)})}),S("#gameDetailEditBtn").addEventListener("click",function(){serverRequestBtn(this,"gameTextSave.php",getPostVars({gameId:GB.gameDetail.id,price:S("#gameDetailPrice").value,rrc_price:S("#gameDetailRrc").value,comment:S("#gameDetailComment").value,opinion:S("#gameDetailOpinion").value}),function(){})}),S("#gameDetailDeleteBtn").addEventListener("click",function(){serverRequestBtn(this,"gameHideShow.php",getPostVars({itemId:GB.gameDetail.id,hide:1}),function(){S("#newGameSearchBlock").classList.remove("hide"),S("#gameContent").classList.remove("hide"),S("#gameDetail").classList.add("hide"),S("#gameDetail .rating_widget").innerHTML="",S("#gameContent").removeChild(S("#gameContent .block_with_img div[data-id='"+GB.gameDetail.id+"']").parentNode.parentNode)})}),S("#gamePersonalStatBtn").addEventListener("click",function(){serverRequestBtn(this,"gamePersonalStat.php",getPostVars({gameId:GB.gameDetail.id}),function(e){e.gameName=GB.gameDetail.name,e.gameImg=GB.gameDetail.img,GB.pup.setContent(contentRender(e,"#gamePersonalStatsTemplate")),GB.pup.show()})}),S("#gameGlobalStatBtn").addEventListener("click",function(){var e={title:"В разработке.",text:"Глобальная статистика среди всех игроков в системе будет доступна позже."};GB.pup.setContent(contentRender(e,"#pupTextTemplate")),GB.pup.show()}),S("#gameDetailMatchesBtn").addEventListener("click",function(){var e={title:"В разработке.",text:"Будет доступно позже."};GB.pup.setContent(contentRender(e,"#pupTextTemplate")),GB.pup.show()}),S("#addNewPlayerBtn").addEventListener("click",function(){serverRequestBtn(this,"playerAdd.php","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&name="+S("#newPlayer").value,function(e){insertItemInListBySort("#playerContent","name",htmlStringToElement(contentRender(e,"#playerBlockTemplate")).querySelector(".pinned_btn"),0),S("#newPlayer").value=""})}),S("#playerContent").addEventListener("click",playerBtnHandler),S("#newGroup").addEventListener("click",function(){S("#playersListForGroup").classList.add("sub_block_opened")}),SA(".list_collpased_btn").forEach(function(e){e.addEventListener("click",function(){e.parentNode.classList.remove("sub_block_opened")})}),S("#playersListData").addEventListener("click",function(e){var t=checkBtn(e.target,"playersListData","check_btn");t&&toCheckBtn(t)}),S("#addNewGroupBtn").addEventListener("click",function(){var e=getSelectedInList(S("#playersListData"),"data-id");serverRequestBtn(this,"groupAdd.php","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&name="+S("#newGroup").value+"&playersList="+e.toString(),function(e){insertItemInListBySort("#groupContent","name",htmlStringToElement(contentRender(e,"#groupBlockTemplate")).querySelector(".pinned_btn"),0),S("#newGroup").value="",SA("#playersListData div[data-selected='1']").forEach(function(e){e.setAttribute("data-selected",0),e.children[0].textContent=""}),S("#playersListForGroup").classList.remove("sub_block_opened")})}),S("#groupContent").addEventListener("click",groupBtnHandler),S("#addNewLocationBtn").addEventListener("click",function(){serverRequestBtn(this,"locationAdd.php","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&name="+S("#newLocation").value,function(e){insertItemInListBySort("#locationContent","name",htmlStringToElement(contentRender(e,"#locationBlockTemplate")).querySelector(".pinned_btn"),0),S("#newLocation").value=""})}),S("#locationContent").addEventListener("click",locationBtnHandler),S("#newTag").addEventListener("click",function(){S("#newTagType").classList.add("sub_block_opened")}),SA("#newTagType .toggle_btn").forEach(function(e){e.addEventListener("click",toggleWidgetHandler)}),S("#addNewTagBtn").addEventListener("click",function(){var n=S("#newTagType").getAttribute("data-value");serverRequestBtn(this,"tagAdd.php","email="+localStorage.email+"&pas="+localStorage.pas+"&userId="+localStorage.bgsId+"&name="+S("#newTag").value+"&type="+n,function(e){var t=contentRender(e,"#tagBlockTemplate");n=n.charAt(0).toUpperCase()+n.substr(1);var a=htmlStringToElement(t);insertItemInListBySort("#tagContent"+n,"name",a.querySelector(".pinned_btn"),0),S("#newTag").value="",S("#newTagType").classList.remove("sub_block_opened")})}),S("#tagContent").addEventListener("click",tagBtnHandler),localStorage.bgsId?(S(".main_block").classList.add("show"),viewManager(),window.addEventListener("hashchange",viewManager)):S(".logRegForm").classList.add("show"),S("#regBtn").addEventListener("click",function(){serverRequestBtn(this,"userReg.php","email="+S("#email").value+"&pas="+S("#pas").value+"&time="+Math.floor(Date.now()/1e3),logRegSuccess)}),S("#logBtn").addEventListener("click",function(){serverRequestBtn(this,"userLogin.php","email="+S("#email").value+"&pas="+S("#pas").value+"&time="+Math.floor(Date.now()/1e3),logRegSuccess)}),S(".menu_item_logout").addEventListener("click",function(){localStorage.clear(),window.location="/bgstat"}),S(".menu_button").addEventListener("click",function(){hasCssClass(S(".menu"),"menu_show")?hideMenu():(S(".menu").classList.add("menu_show"),S(".menu_button").classList.add("active_menu_button"),S(".menu_shadow").classList.add("menu_shadow_show"))}),SA(".menu_item").forEach(function(e){e.addEventListener("click",menuItemHandler)}),S(".menu_shadow").addEventListener("click",hideMenu);
